---
import Nav from "../components/nav.astro";
import Footer from "../components/footer.astro";
import SpeedInsights from '@vercel/speed-insights/astro';
import "../styles/global.css";
import ThemeToggle from "../components/ThemeToggle.astro";

interface Props {
  title?: string;
  description?: string;
}

const {
  title = "Shay Henderson | Software and Infrastructure Engineer",
  description = "Software & Infrastructure Engineer with 6+ years building scalable web, mobile, and cloud solutions. Specializing in development, QA, DevOps, and support."
} = Astro.props;

// Site URL and canonical URL setup
const siteUrl = "https://www.shayhenderson.dev";
const canonicalURL = new URL(Astro.url.pathname, siteUrl).href;
const image = `${siteUrl}/shay-portfolio.webp`;
---

<!DOCTYPE html>
<html lang="en" class="overflow-x-hidden">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="preconnect" href="https://va.vercel-scripts.com" crossorigin />
    <link rel="preconnect" href="https://github-contributions-api.jogruber.de" crossorigin />

    <link rel="icon" type="image/svg+xml" href="/logo-light.svg" id="favicon" />
    <meta name="generator" content={Astro.generator} />

    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#000000" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="author" content="Shay Henderson" />
    <meta name="robots" content="index, follow" />
    <meta name="keywords" content="software engineer, infrastructure engineer, cloud engineer, QA engineer, full-stack developer, React, Next.js, TypeScript, GCP, Cloudflare, Google Cloud Platform, site reliability, technical support, Shay Henderson, portfolio" />
    <meta name="language" content="en" />
    <meta name="geo.region" content="GB-SCT" />
    <meta name="geo.placename" content="Scotland" />

    <link rel="canonical" href={canonicalURL} />
    <meta property="article:modified_time" content={new Date().toISOString()} />

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="format-detection" content="telephone=no" />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={image} />
    <meta property="og:site_name" content="Shay Henderson Portfolio" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Shay Henderson - Web Developer Portfolio" />
    <meta property="og:image:type" content="image/webp" />
    <meta property="og:author" content="Shay Henderson" />
    <meta property="og:section" content="Technology" />
    <meta property="og:tag" content="web development, portfolio, React, Next.js, Astro" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
    <meta name="twitter:image:alt" content="Shay Henderson - Web Developer Portfolio" />
    <meta name="twitter:domain" content="www.shayhenderson.dev" />

    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Shay Henderson",
      "jobTitle": "Software and Infrastructure Engineer",
      "url": siteUrl,
      "sameAs": [
        "https://github.com/HendoBuilds",
        "https://www.linkedin.com/in/shay-henderson/"
      ],
      "knowsAbout": [
        "React",
        "TypeScript",
        "Next.js",
        "Astro",
        "Google Cloud Platform",
        "Cloudflare",
        "Site Reliability Engineering",
        "QA Engineering",
        "Infrastructure Engineering"
      ],
      "description": description
    })} />

    <SpeedInsights />
  </head>
  <body class="min-h-screen font-sans flex flex-col overflow-x-hidden">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-md focus:shadow-lg">Skip to main content</a>

    <div class="w-full max-w-4xl mx-auto bg-card shadow-lg md:shadow-2xl py-0 px-4 md:px-6 lg:px-8 flex flex-col min-h-screen md:border-l md:border-r box-border">
      <div class="flex items-center justify-between w-full mt-2 gap-1.5 md:gap-3">
        <div class="w-9 md:w-11 flex justify-start flex-shrink-0">
          <a href="/" aria-label="Back to home" class="min-h-[44px] min-w-[44px] flex items-center justify-center">
            <img id="logo-light" src="/logo-light.svg" alt="Site logo" width="44" height="44" loading="eager" fetchpriority="high" class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-background/80 backdrop-blur-md shadow-lg border object-cover" />
            <img id="logo-dark" src="/logo-dark.svg" alt="Site logo" width="44" height="44" loading="eager" fetchpriority="high" class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-background/80 backdrop-blur-md shadow-lg border object-cover hidden" />
          </a>
        </div>
        <div class="flex-1 flex justify-center min-w-0">
          <div class="bg-background/80 rounded-full shadow-lg backdrop-blur-md border flex items-center max-w-full">
            <Nav class="m-0" />
          </div>
        </div>
        <div class="w-9 md:w-11 flex justify-end flex-shrink-0">
          <div class="bg-background/80 rounded-full shadow-lg backdrop-blur-md border flex items-center">
            <ThemeToggle />
          </div>
        </div>
      </div>
      <main id="main-content" class="flex-grow">
        <slot />
      </main>
      <Footer />
    </div>
    <script>
      function updateTheme() {
        const favicon = document.getElementById('favicon') as HTMLLinkElement;
        const logoLight = document.getElementById('logo-light');
        const logoDark = document.getElementById('logo-dark');

        if (document.documentElement.classList.contains('dark')) {
          if (favicon) favicon.href = '/logo-dark.svg';
          if (logoLight) logoLight.classList.add('hidden');
          if (logoDark) logoDark.classList.remove('hidden');
        } else {
          if (favicon) favicon.href = '/logo-light.svg';
          if (logoLight) logoLight.classList.remove('hidden');
          if (logoDark) logoDark.classList.add('hidden');
        }
      }

      document.addEventListener('DOMContentLoaded', updateTheme);

      const observer = new MutationObserver(updateTheme);
      observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
    </script>
  </body>
</html>
